{% extends 'base.html' %}

{% load static %}

{% block title %}
  	Parking Allotment
{% endblock title %}

{% block header %}
  	<h1 class="mt-4 md:ml-5 pb-2 md:text-left text-center text-white font-bold text-4xl">Parking Allotment</h1>
{% endblock header %}

{% block content %}
<section class="parking-allotment">
	<!-- Toggle Buttons and Status Box -->
	<div id="toggle-container" class="flex flex-col md:flex-row items-center justify-center md:justify-between px-6 md:px-12 py-6 gap-6 md:gap-12">
		<div class="flex gap-4">
			<button id="car-toggle" class="flex items-center justify-center gap-3 w-[180px] h-[60px] rounded-xl bg-[#7cd1f9] text-white font-semibold shadow-md">
				<i class="fa-solid fa-car-side"></i>
				<span>4 - Wheels</span>
			</button>
			{% if user.is_admin %}
				<button id="live-toggle" class="flex items-center justify-center gap-3 w-[180px] h-[60px] rounded-xl bg-gray-200 text-black font-semibold shadow-md">
					<span>Live Feed</span>
				</button>
			{% endif %}
		</div>

		<!-- Status Container -->
		<div id="status-container">
			<div id="car-status" class="w-full md:w-[280px] h-[130px] bg-white border border-gray-300 rounded-lg shadow px-4 py-2 text-center flex flex-col justify-center">
				<p class="text-lg md:text-xl text-black-500">Available Parking</p>
				<p class="text-4xl font-bold text-black">18</p>
			</div>
		</div>
	</div>

	<!-- ================= CAR SECTION (Picture Display) ================= -->
	<div id="car-section" class="section-content">
		<div class="container mx-auto px-4">
			<!-- Mobile Controls -->
			<div id="mobile-controls" class="flex justify-between items-center mb-4 md:hidden">
				<div class="flex gap-2">
					<button id="zoom-in" class="w-10 h-10 bg-white rounded-full shadow-md flex items-center justify-center">
						<i class="fa-solid fa-plus"></i>
					</button>
					<button id="zoom-out" class="w-10 h-10 bg-white rounded-full shadow-md flex items-center justify-center">
						<i class="fa-solid fa-minus"></i>
					</button>
				</div>
				<button id="reset-view" class="w-10 h-10 bg-white rounded-full shadow-md flex items-center justify-center">
					<i class="fa-solid fa-arrows-rotate"></i>
				</button>
			</div>
			
			<div class="relative w-full h-[50vh] md:h-[95vh] border border-gray-300 rounded-lg shadow-md mb-6 overflow-hidden">
				<!-- Interactive Container for Mobile -->
				<div id="parking-container" class="w-full h-full touch-pan-y md:touch-none select-none cursor-grab active:cursor-grabbing">
					<!-- Background Image -->
					<img id="parking-image" class="w-full h-full object-cover rounded-lg transition-transform duration-300" src="{% static 'images/parkingallotment.jpg' %}" alt="Parking Layout">
					
					<!-- Overlay Indicators -->

					<!-- Top row indicators -->
					<div class="absolute top-[10%] left-[35.5%] w-4 h-4 md:w-6 md:h-6 bg-green-500 rounded-full shadow-md"></div>
					<div class="absolute top-[10%] left-[39.5%] w-4 h-4 md:w-6 md:h-6 bg-red-500 rounded-full shadow-md"></div>
					<div class="absolute top-[10%] left-[43.5%] w-4 h-4 md:w-6 md:h-6 bg-red-500 rounded-full shadow-md"></div>
					<div class="absolute top-[10%] left-[46.5%] w-4 h-4 md:w-6 md:h-6 bg-green-500 rounded-full shadow-md"></div>
					<div class="absolute top-[10%] left-[50.5%] w-4 h-4 md:w-6 md:h-6 bg-red-500 rounded-full shadow-md"></div>
					<div class="absolute top-[10%] left-[54.4%] w-4 h-4 md:w-6 md:h-6 bg-green-500 rounded-full shadow-md"></div>
					<div class="absolute top-[10%] left-[58.4%] w-4 h-4 md:w-6 md:h-6 bg-red-500 rounded-full shadow-md"></div>
					<div class="absolute top-[10%] left-[62%] w-4 h-4 md:w-6 md:h-6 bg-green-500 rounded-full shadow-md"></div>
					<div class="absolute top-[10%] left-[65.4%] w-4 h-4 md:w-6 md:h-6 bg-red-500 rounded-full shadow-md"></div>
					<div class="absolute top-[10%] left-[69.4%] w-4 h-4 md:w-6 md:h-6 bg-red-500 rounded-full shadow-md"></div>

					<!-- Right side -->
					<div class="absolute top-[14%] left-[84%] w-4 h-4 md:w-6 md:h-6 bg-green-500 rounded-full shadow-md"></div>
					<div class="absolute top-[18.5%] left-[84%] w-4 h-4 md:w-6 md:h-6 bg-red-500 rounded-full shadow-md"></div>
					<div class="absolute top-[23%] left-[84%] w-4 h-4 md:w-6 md:h-6 bg-red-500 rounded-full shadow-md"></div>
					<div class="absolute top-[27.5%] left-[84%] w-4 h-4 md:w-6 md:h-6 bg-green-500 rounded-full shadow-md"></div>

					<!-- middle top -->
					<div class="absolute top-[40%] left-[58.4%] w-4 h-4 md:w-6 md:h-6 bg-green-500 rounded-full shadow-md"></div>
					<div class="absolute top-[40%] left-[54.4%] w-4 h-4 md:w-6 md:h-6 bg-red-500 rounded-full shadow-md"></div>
					<div class="absolute top-[40%] left-[50.5%] w-4 h-4 md:w-6 md:h-6 bg-green-500 rounded-full shadow-md"></div>
					<div class="absolute top-[40%] left-[46.5%] w-4 h-4 md:w-6 md:h-6 bg-red-500 rounded-full shadow-md"></div>
					<div class="absolute top-[40%] left-[43.5%] w-4 h-4 md:w-6 md:h-6 bg-green-500 rounded-full shadow-md"></div>
					<div class="absolute top-[40%] left-[39.5%] w-4 h-4 md:w-6 md:h-6 bg-red-500 rounded-full shadow-md"></div>
					<div class="absolute top-[40%] left-[36.5%] w-4 h-4 md:w-6 md:h-6 bg-red-500 rounded-full shadow-md"></div>

					<div class="absolute top-[40%] left-[62%] w-4 h-4 md:w-6 md:h-6 bg-green-500 rounded-full shadow-md"></div>
					<div class="absolute top-[40%] left-[66.5%] w-4 h-4 md:w-6 md:h-6 bg-red-500 rounded-full shadow-md"></div>

					<!-- middle below -->
					<div class="absolute top-[52%] left-[57.4%] w-4 h-4 md:w-6 md:h-6 bg-green-500 rounded-full shadow-md"></div>
					<div class="absolute top-[52%] left-[54.4%] w-4 h-4 md:w-6 md:h-6 bg-red-500 rounded-full shadow-md"></div>
					<div class="absolute top-[52%] left-[50.5%] w-4 h-4 md:w-6 md:h-6 bg-red-500 rounded-full shadow-md"></div>
					<div class="absolute top-[52%] left-[47.5%] w-4 h-4 md:w-6 md:h-6 bg-green-500 rounded-full shadow-md"></div>
					<div class="absolute top-[52%] left-[43.5%] w-4 h-4 md:w-6 md:h-6 bg-red-500 rounded-full shadow-md"></div>
					<div class="absolute top-[52%] left-[40.5%] w-4 h-4 md:w-6 md:h-6 bg-green-500 rounded-full shadow-md"></div>
		
					<div class="absolute top-[52%] left-[62%] w-4 h-4 md:w-6 md:h-6 bg-green-500 rounded-full shadow-md"></div>
					<div class="absolute top-[52%] left-[65.5%] w-4 h-4 md:w-6 md:h-6 bg-red-500 rounded-full shadow-md"></div>

					<!-- Bottom row (left side) -->
					<div class="absolute top-[90%] left-[26.5%] w-4 h-4 md:w-6 md:h-6 bg-red-500 rounded-full shadow-md"></div>
					<div class="absolute top-[90%] left-[30.5%] w-4 h-4 md:w-6 md:h-6 bg-green-500 rounded-full shadow-md"></div>
					<div class="absolute top-[90%] left-[34.5%] w-4 h-4 md:w-6 md:h-6 bg-red-500 rounded-full shadow-md"></div>
					<div class="absolute top-[90%] left-[38%] w-4 h-4 md:w-6 md:h-6 bg-green-500 rounded-full shadow-md"></div>

					<!-- Bottom row (right side) -->
					<div class="absolute top-[85%] left-[45%] w-4 h-4 md:w-6 md:h-6 bg-green-500 rounded-full shadow-md"></div>
					<div class="absolute top-[85%] left-[49%] w-4 h-4 md:w-6 md:h-6 bg-red-500 rounded-full shadow-md"></div>
					<div class="absolute top-[85%] left-[52%] w-4 h-4 md:w-6 md:h-6 bg-red-500 rounded-full shadow-md"></div>
					<div class="absolute top-[85%] left-[56%] w-4 h-4 md:w-6 md:h-6 bg-green-500 rounded-full shadow-md"></div>
				</div>
			</div>
		</div>

		<!-- Description -->
		<div class="px-6 md:px-12 pb-10">
			<div class="flex flex-col gap-3">
				<div class="flex items-center gap-3">
					<div class="w-4 h-4 md:w-6 md:h-6 bg-red-500 rounded-full"></div>
					<span class="text-sm md:text-base font-semibold text-black">Occupied</span>
				</div>
				<div class="flex items-center gap-3">
					<div class="w-4 h-4 md:w-6 md:h-6 bg-green-500 rounded-full"></div>
					<span class="text-sm md:text-base font-semibold text-black">Vacant</span>
				</div>
			</div>
		</div>
	</div>

	<!-- ================= LIVE SECTION ================= -->
	<div id="live-section" class="section-content hidden">
		<div class="container mx-auto px-4 py-6">
			<div class="flex justify-end mb-6">
				<div class="w-full md:w-[320px] bg-gray-100 rounded-xl shadow-lg px-8 py-6 text-center">
					<p class="text-3xl font-bold mb-4">Parking Slots</p>
					<div class="grid grid-cols-2">
						<div>
							<p class="text-2xl font-bold">Vacant</p>
							<div id="vacant-count" class="text-3xl font-bold text-green-500"></div>
						</div>
						<div>
							<p class="text-2xl font-bold">Occupied</p>
							<div id="occupied-count" class="text-3xl font-bold text-red-600"></div>
						</div>
					</div>
				</div>
			</div>

			<video id="video" class="w-full h-[50vh] md:h-[80vh] border border-gray-300 rounded-lg shadow-md flex items-center justify-center mb-6" controls autoplay>
				<source src="/media/video_stream/stream.m3u8" type="application/x-mpegURL">
			</video>
			
			<div class="flex justify-start">
				<button id="back-to-car" class="flex items-center gap-3 px-6 py-4 rounded-xl bg-[#7cd1f9] text-white font-semibold shadow-md">
					Back to Visual Feed
				</button>
			</div>
		</div>
	</div>
</section>
{% endblock %}

{% block script %}
  <script type="module" src="{% static 'javascript/parkingAllotment.js' %}"></script>
{% endblock script %}